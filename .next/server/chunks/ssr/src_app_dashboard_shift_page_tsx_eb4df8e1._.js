module.exports=[66321,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(16259),e=a.i(99570),f=a.i(66718),g=a.i(91119),h=a.i(70430),i=a.i(86304),j=a.i(14574),k=a.i(6015),l=a.i(41710),m=a.i(24669);let n=(0,a.i(70106).default)("calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);var o=a.i(71931);function p(){let{user:a}=(0,d.useAuth)(),[p,q]=(0,c.useState)(null),[r,s]=(0,c.useState)([]),[t,u]=(0,c.useState)(!1),[v,w]=(0,c.useState)(!1),[x,y]=(0,c.useState)(0),[z,A]=(0,c.useState)(0),[B,C]=(0,c.useState)(""),[D,E]=(0,c.useState)(null);(0,c.useEffect)(()=>{F(),G()},[]);let F=async()=>{try{let a=await fetch("/api/shifts",{credentials:"include"});if(a.ok){let b=await a.json();s(Array.isArray(b)?b:[])}}catch(a){console.error("Error fetching shifts:",a)}},G=async()=>{try{let b=await fetch("/api/shifts?status=OPEN",{credentials:"include"});if(b.ok){let c=await b.json(),d=(Array.isArray(c)?c:[]).find(b=>b.userId===a?.id);q(d||null)}}catch(a){console.error("Error checking current shift:",a)}},H=async a=>{a.preventDefault();try{let a=await fetch("/api/shifts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"start",startingCash:x}),credentials:"include"});if(a.ok){let b=await a.json();q(b),u(!1),y(0),alert("Shift berhasil dimulai!"),F()}else{let b=await a.json();alert(`Gagal memulai shift: ${b.error}`)}}catch(a){console.error("Error starting shift:",a),alert("Terjadi kesalahan saat memulai shift")}},I=async a=>{a.preventDefault();try{let a=await fetch("/api/shifts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"close",endingCash:z,notes:B}),credentials:"include"});if(a.ok){let b=await a.json();E(b.summary),q(null),w(!1),A(0),C(""),alert("Shift berhasil ditutup!"),F()}else{let b=await a.json();alert(`Gagal menutup shift: ${b.error}`)}}catch(a){console.error("Error closing shift:",a),alert("Terjadi kesalahan saat menutup shift")}};return(0,b.jsxs)("div",{className:"p-6",children:[(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Tutup Kasir"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Kelola shift kasir dan hitung kas"})]}),(0,b.jsxs)(g.Card,{className:"mb-6",children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsxs)(g.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(l.Clock,{className:"h-5 w-5"}),"Status Shift Saat Ini"]})}),(0,b.jsx)(g.CardContent,{children:p?(0,b.jsx)("div",{className:"space-y-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Badge,{variant:"default",children:"SHIFT AKTIF"}),(0,b.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["Petugas: ",a?.name]}),(0,b.jsxs)("p",{className:"text-sm text-gray-600",children:["Dimulai: ",new Date(p.startTime).toLocaleString("id-ID")]}),(0,b.jsxs)("p",{className:"text-sm text-gray-600",children:["Kas Awal: Rp ",p.startingCash.toLocaleString()]})]}),(0,b.jsx)(e.Button,{onClick:()=>w(!0),children:"Tutup Shift"})]})}):(0,b.jsxs)("div",{className:"text-center py-8",children:[(0,b.jsx)("p",{className:"text-gray-500 mb-4",children:"Tidak ada shift aktif"}),(0,b.jsxs)(j.Dialog,{open:t,onOpenChange:u,children:[(0,b.jsx)(j.DialogTrigger,{asChild:!0,children:(0,b.jsx)(e.Button,{children:"Mulai Shift"})}),(0,b.jsxs)(j.DialogContent,{children:[(0,b.jsx)(j.DialogHeader,{children:(0,b.jsx)(j.DialogTitle,{children:"Mulai Shift Kasir"})}),(0,b.jsxs)("form",{onSubmit:H,className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"startingCash",children:"Kas Awal (Rp)"}),(0,b.jsx)(f.Input,{id:"startingCash",type:"number",value:x,onChange:a=>y(parseFloat(a.target.value)||0),placeholder:"Masukkan jumlah kas awal",required:!0})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsx)(e.Button,{type:"button",variant:"outline",onClick:()=>u(!1),children:"Batal"}),(0,b.jsx)(e.Button,{type:"submit",children:"Mulai Shift"})]})]})]})]})]})})]}),(0,b.jsxs)(g.Card,{children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsx)(g.CardTitle,{children:"Riwayat Shift"})}),(0,b.jsx)(g.CardContent,{children:0===r.length?(0,b.jsx)("div",{className:"text-center py-8 text-gray-500",children:"Belum ada riwayat shift"}):(0,b.jsxs)(k.Table,{children:[(0,b.jsx)(k.TableHeader,{children:(0,b.jsxs)(k.TableRow,{children:[(0,b.jsx)(k.TableHead,{children:"Tanggal"}),(0,b.jsx)(k.TableHead,{children:"Petugas"}),(0,b.jsx)(k.TableHead,{children:"Durasi"}),(0,b.jsx)(k.TableHead,{children:"Kas Awal"}),(0,b.jsx)(k.TableHead,{children:"Kas Akhir"}),(0,b.jsx)(k.TableHead,{children:"Penjualan"}),(0,b.jsx)(k.TableHead,{children:"Catatan"}),(0,b.jsx)(k.TableHead,{children:"Status"})]})}),(0,b.jsx)(k.TableBody,{children:r.map(a=>(0,b.jsxs)(k.TableRow,{children:[(0,b.jsx)(k.TableCell,{children:(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:new Date(a.startTime).toLocaleDateString("id-ID")}),(0,b.jsxs)("div",{className:"text-xs text-gray-500",children:[new Date(a.startTime).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}),a.endTime&&` - ${new Date(a.endTime).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"})}`]})]})}),(0,b.jsx)(k.TableCell,{children:(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:a.user?.name||"Unknown"}),(0,b.jsx)("div",{className:"text-xs text-gray-500",children:a.user?.role})]})}),(0,b.jsx)(k.TableCell,{children:a.endTime?`${Math.round((new Date(a.endTime).getTime()-new Date(a.startTime).getTime())/36e5)} jam`:"Aktif"}),(0,b.jsxs)(k.TableCell,{children:["Rp ",a.startingCash.toLocaleString()]}),(0,b.jsx)(k.TableCell,{children:a.endingCash?`Rp ${a.endingCash.toLocaleString()}`:"-"}),(0,b.jsxs)(k.TableCell,{children:["Rp ",a.totalSales.toLocaleString()]}),(0,b.jsx)(k.TableCell,{children:a.notes?(0,b.jsx)("div",{className:"max-w-xs",children:(0,b.jsx)("p",{className:"text-sm truncate",title:a.notes,children:a.notes})}):(0,b.jsx)("span",{className:"text-gray-400",children:"-"})}),(0,b.jsx)(k.TableCell,{children:(0,b.jsx)(i.Badge,{variant:"OPEN"===a.status?"default":"secondary",children:"OPEN"===a.status?"Aktif":"Tutup"})})]},a.id))})]})})]}),(0,b.jsx)(j.Dialog,{open:v,onOpenChange:w,children:(0,b.jsxs)(j.DialogContent,{className:"max-w-md",children:[(0,b.jsx)(j.DialogHeader,{children:(0,b.jsx)(j.DialogTitle,{children:"Tutup Shift Kasir"})}),(0,b.jsxs)("form",{onSubmit:I,className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"endingCash",children:"Kas Akhir (Rp)"}),(0,b.jsx)(f.Input,{id:"endingCash",type:"number",value:z,onChange:a=>A(parseFloat(a.target.value)||0),placeholder:"Hitung kas fisik saat ini",required:!0})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"notes",children:"Catatan (Opsional)"}),(0,b.jsx)(f.Input,{id:"notes",value:B,onChange:a=>C(a.target.value),placeholder:"Catatan untuk shift ini"})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsx)(e.Button,{type:"button",variant:"outline",onClick:()=>w(!1),children:"Batal"}),(0,b.jsx)(e.Button,{type:"submit",children:"Tutup Shift"})]})]})]})}),D&&(0,b.jsx)(j.Dialog,{open:!!D,onOpenChange:()=>E(null),children:(0,b.jsxs)(j.DialogContent,{className:"max-w-md",children:[(0,b.jsx)(j.DialogHeader,{children:(0,b.jsx)(j.DialogTitle,{children:"Ringkasan Shift"})}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"text-center p-3 bg-blue-50 rounded",children:[(0,b.jsx)(m.TrendingUp,{className:"h-6 w-6 mx-auto mb-2 text-blue-600"}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Total Penjualan"}),(0,b.jsxs)("p",{className:"font-bold",children:["Rp ",D.totalSales.toLocaleString()]})]}),(0,b.jsxs)("div",{className:"text-center p-3 bg-green-50 rounded",children:[(0,b.jsx)(n,{className:"h-6 w-6 mx-auto mb-2 text-green-600"}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Transaksi"}),(0,b.jsx)("p",{className:"font-bold",children:D.totalTransactions})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{children:"Kas Seharusnya:"}),(0,b.jsxs)("span",{children:["Rp ",D.netCash.toLocaleString()]})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{children:"Kas Aktual:"}),(0,b.jsxs)("span",{children:["Rp ",D.actualCash.toLocaleString()]})]}),(0,b.jsxs)("div",{className:"flex justify-between font-bold",children:[(0,b.jsx)("span",{children:"Selisih:"}),(0,b.jsxs)("span",{className:D.difference>=0?"text-green-600":"text-red-600",children:["Rp ",D.difference.toLocaleString()]})]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>E(null),className:"flex-1",children:"Tutup"}),(0,b.jsxs)(e.Button,{onClick:()=>{if(!D)return;let b=window.open("","_blank");if(!b)return;let c=`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Laporan Tutup Kasir</title>
        <style>
          body { font-family: Arial, sans-serif; margin: 20px; }
          .header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 20px; }
          .section { margin: 20px 0; }
          .item { display: flex; justify-content: space-between; margin: 5px 0; }
          .total { border-top: 1px solid #000; padding-top: 10px; font-weight: bold; }
        </style>
      </head>
      <body>
        <div class="header">
          <h2>LAPORAN TUTUP KASIR</h2>
          <p>Gita Fashion</p>
          <p>${new Date().toLocaleString("id-ID")}</p>
        </div>
        
        <div class="section">
          <h3>Kasir: ${a?.name}</h3>
          <div class="item"><span>Waktu Tutup:</span><span>${new Date().toLocaleString("id-ID")}</span></div>
        </div>

        <div class="section">
          <h3>Ringkasan Penjualan</h3>
          <div class="item"><span>Total Transaksi:</span><span>${D.totalTransactions}</span></div>
          <div class="item"><span>Total Penjualan:</span><span>Rp ${D.totalSales.toLocaleString("id-ID")}</span></div>
          <div class="item"><span>Total Pengeluaran:</span><span>Rp ${D.totalExpenses.toLocaleString("id-ID")}</span></div>
        </div>

        <div class="section">
          <h3>Kas</h3>
          <div class="item"><span>Kas Awal:</span><span>Rp ${(p?.startingCash||0).toLocaleString("id-ID")}</span></div>
          <div class="item"><span>Kas Seharusnya:</span><span>Rp ${D.netCash.toLocaleString("id-ID")}</span></div>
          <div class="item"><span>Kas Aktual:</span><span>Rp ${D.actualCash.toLocaleString("id-ID")}</span></div>
          <div class="item total"><span>Selisih:</span><span>Rp ${D.difference.toLocaleString("id-ID")}</span></div>
        </div>
      </body>
      </html>
    `;b.document.open(),b.document.write(c),b.document.close(),setTimeout(()=>{b.print()},100),setTimeout(()=>{b.close()},1e3)},className:"flex-1",children:[(0,b.jsx)(o.Printer,{className:"h-4 w-4 mr-2"}),"Cetak Laporan"]})]})]})]})})]})}a.s(["default",()=>p],66321)}];

//# sourceMappingURL=src_app_dashboard_shift_page_tsx_eb4df8e1._.js.map