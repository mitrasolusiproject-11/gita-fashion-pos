module.exports=[47974,e=>{"use strict";var t=e.i(47909),r=e.i(74017),a=e.i(96250),o=e.i(59756),c=e.i(61916),n=e.i(14444),i=e.i(37092),s=e.i(69741),d=e.i(16795),u=e.i(87718),l=e.i(95169),p=e.i(47587),g=e.i(66012),h=e.i(70101),m=e.i(26937),R=e.i(10372),y=e.i(93695);e.i(52474);var f=e.i(220),S=e.i(89171),w=e.i(43793),A=e.i(35839),v=e.i(10506),k=e.i(75225);async function b(e){try{if(!await (0,v.getSession)(e))return S.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:t}=new URL(e.url),r=t.get("search"),a=t.get("category"),o=(r&&a?await w.db.select({id:A.products.id,barcode:A.products.barcode,name:A.products.name,categoryId:A.products.categoryId,initialStock:A.products.initialStock,currentStock:A.products.currentStock,sellPrice:A.products.sellPrice,createdAt:A.products.createdAt,updatedAt:A.products.updatedAt,categoryName:A.categories.name}).from(A.products).leftJoin(A.categories,(0,k.eq)(A.products.categoryId,A.categories.id)).where((0,k.and)((0,k.or)((0,k.like)(A.products.name,`%${r}%`),(0,k.like)(A.products.barcode,`%${r}%`)),(0,k.eq)(A.categories.name,a))):r?await w.db.select({id:A.products.id,barcode:A.products.barcode,name:A.products.name,categoryId:A.products.categoryId,initialStock:A.products.initialStock,currentStock:A.products.currentStock,sellPrice:A.products.sellPrice,createdAt:A.products.createdAt,updatedAt:A.products.updatedAt,categoryName:A.categories.name}).from(A.products).leftJoin(A.categories,(0,k.eq)(A.products.categoryId,A.categories.id)).where((0,k.or)((0,k.like)(A.products.name,`%${r}%`),(0,k.like)(A.products.barcode,`%${r}%`))):a?await w.db.select({id:A.products.id,barcode:A.products.barcode,name:A.products.name,categoryId:A.products.categoryId,initialStock:A.products.initialStock,currentStock:A.products.currentStock,sellPrice:A.products.sellPrice,createdAt:A.products.createdAt,updatedAt:A.products.updatedAt,categoryName:A.categories.name}).from(A.products).leftJoin(A.categories,(0,k.eq)(A.products.categoryId,A.categories.id)).where((0,k.eq)(A.categories.name,a)):await w.db.select({id:A.products.id,barcode:A.products.barcode,name:A.products.name,categoryId:A.products.categoryId,initialStock:A.products.initialStock,currentStock:A.products.currentStock,sellPrice:A.products.sellPrice,createdAt:A.products.createdAt,updatedAt:A.products.updatedAt,categoryName:A.categories.name}).from(A.products).leftJoin(A.categories,(0,k.eq)(A.products.categoryId,A.categories.id))).map(e=>({id:e.id,barcode:e.barcode,name:e.name,categoryId:e.categoryId,category:e.categoryName||"Uncategorized",initialStock:e.initialStock,currentStock:e.currentStock,sellPrice:e.sellPrice,createdAt:e.createdAt}));return S.NextResponse.json(o)}catch(e){return console.error("Error fetching products:",e),S.NextResponse.json({error:"Internal server error"},{status:500})}}async function E(e){try{if(!await (0,v.getSession)(e))return S.NextResponse.json({error:"Unauthorized"},{status:401});let{barcode:t,name:r,category:a,initialStock:o,sellPrice:c}=await e.json(),n=null;if(a){let[e]=await w.db.select().from(A.categories).where((0,k.eq)(A.categories.name,a)).limit(1);n=e?.id||null}let i={barcode:t||`GF${Date.now().toString().slice(-6)}${Math.floor(1e3*Math.random()).toString().padStart(3,"0")}`,name:r,initialStock:o,currentStock:o,sellPrice:c};n&&(i.categoryId=n);let[s]=await w.db.insert(A.products).values(i).returning(),[d]=await w.db.select({id:A.products.id,barcode:A.products.barcode,name:A.products.name,categoryId:A.products.categoryId,initialStock:A.products.initialStock,currentStock:A.products.currentStock,sellPrice:A.products.sellPrice,createdAt:A.products.createdAt,updatedAt:A.products.updatedAt,categoryName:A.categories.name}).from(A.products).leftJoin(A.categories,(0,k.eq)(A.products.categoryId,A.categories.id)).where((0,k.eq)(A.products.id,s.id)),u={id:d.id,barcode:d.barcode,name:d.name,categoryId:d.categoryId,category:d.categoryName||"Uncategorized",initialStock:d.initialStock,currentStock:d.currentStock,sellPrice:d.sellPrice,createdAt:d.createdAt};return S.NextResponse.json(u,{status:201})}catch(e){return console.error("Error creating product:",e),S.NextResponse.json({error:"Internal server error"},{status:500})}}e.s(["GET",()=>b,"POST",()=>E,"runtime",0,"nodejs"],17861);var P=e.i(17861);let x=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/products/route",pathname:"/api/products",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/products/route.ts",nextConfigOutput:"standalone",userland:P}),{workAsyncStorage:I,workUnitAsyncStorage:N,serverHooks:C}=x;function T(){return(0,a.patchFetch)({workAsyncStorage:I,workUnitAsyncStorage:N})}async function q(e,t,a){x.isDev&&(0,o.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let S="/api/products/route";S=S.replace(/\/index$/,"")||"/";let w=await x.prepare(e,t,{srcPage:S,multiZoneDraftMode:!1});if(!w)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:A,params:v,nextConfig:k,parsedUrl:b,isDraftMode:E,prerenderManifest:P,routerServerContext:I,isOnDemandRevalidate:N,revalidateOnlyGenerated:C,resolvedPathname:T,clientReferenceManifest:q,serverActionsManifest:O}=w,U=(0,s.normalizeAppPath)(S),_=!!(P.dynamicRoutes[U]||P.routes[T]),M=async()=>((null==I?void 0:I.render404)?await I.render404(e,t,b,!1):t.end("This page could not be found"),null);if(_&&!E){let e=!!P.routes[T],t=P.dynamicRoutes[U];if(t&&!1===t.fallback&&!e){if(k.experimental.adapterPath)return await M();throw new y.NoFallbackError}}let H=null;!_||x.isDev||E||(H="/index"===(H=T)?"/":H);let j=!0===x.isDev||!_,$=_&&!j;O&&q&&(0,n.setReferenceManifestsSingleton)({page:S,clientReferenceManifest:q,serverActionsManifest:O,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:O})});let D=e.method||"GET",F=(0,c.getTracer)(),K=F.getActiveScopeSpan(),L={params:v,prerenderManifest:P,renderOpts:{experimental:{authInterrupts:!!k.experimental.authInterrupts},cacheComponents:!!k.cacheComponents,supportsDynamicResponse:j,incrementalCache:(0,o.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:k.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>x.onRequestError(e,t,a,I)},sharedContext:{buildId:A}},z=new d.NodeNextRequest(e),B=new d.NodeNextResponse(t),G=u.NextRequestAdapter.fromNodeNextRequest(z,(0,u.signalFromNodeResponse)(t));try{let n=async e=>x.handle(G,L).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=F.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==l.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${D} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${D} ${S}`)}),i=!!(0,o.getRequestMeta)(e,"minimalMode"),s=async o=>{var c,s;let d=async({previousCacheEntry:r})=>{try{if(!i&&N&&C&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let c=await n(o);e.fetchMetrics=L.renderOpts.fetchMetrics;let s=L.renderOpts.pendingWaitUntil;s&&a.waitUntil&&(a.waitUntil(s),s=void 0);let d=L.renderOpts.collectedTags;if(!_)return await (0,g.sendResponse)(z,B,c,L.renderOpts.pendingWaitUntil),null;{let e=await c.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(c.headers);d&&(t[R.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=R.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,a=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=R.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:f.CachedRouteKind.APP_ROUTE,status:c.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await x.onRequestError(e,t,{routerKind:"App Router",routePath:S,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:$,isOnDemandRevalidate:N})},I),t}},u=await x.handleResponse({req:e,nextConfig:k,cacheKey:H,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:P,isRoutePPREnabled:!1,isOnDemandRevalidate:N,revalidateOnlyGenerated:C,responseGenerator:d,waitUntil:a.waitUntil,isMinimalMode:i});if(!_)return null;if((null==u||null==(c=u.value)?void 0:c.kind)!==f.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(s=u.value)?void 0:s.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",N?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),E&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let l=(0,h.fromNodeOutgoingHttpHeaders)(u.value.headers);return i&&_||l.delete(R.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||l.get("Cache-Control")||l.set("Cache-Control",(0,m.getCacheControlHeader)(u.cacheControl)),await (0,g.sendResponse)(z,B,new Response(u.value.body,{headers:l,status:u.value.status||200})),null};K?await s(K):await F.withPropagatedContext(e.headers,()=>F.trace(l.BaseServerSpan.handleRequest,{spanName:`${D} ${S}`,kind:c.SpanKind.SERVER,attributes:{"http.method":D,"http.target":e.url}},s))}catch(t){if(t instanceof y.NoFallbackError||await x.onRequestError(e,t,{routerKind:"App Router",routePath:U,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:$,isOnDemandRevalidate:N})}),_)throw t;return await (0,g.sendResponse)(z,B,new Response(null,{status:500})),null}}e.s(["handler",()=>q,"patchFetch",()=>T,"routeModule",()=>x,"serverHooks",()=>C,"workAsyncStorage",()=>I,"workUnitAsyncStorage",()=>N],47974)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_ef46ad48.js.map